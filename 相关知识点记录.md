# 后端新增数据库字段 SOP
## 阶段一：修改 Python 代码定义 (Model & Schema)
### 1. 修改数据库模型 (models.py)
- 动作：找到对应的类（如 class User）。
- 操作：添加 Column 定义。
- 注意：
    - 字段类型是否需要 import？(如 DateTime, Boolean)
    - 是否允许为空？(nullable=True vs False)
    - 是否有默认值？(default=...)

### 2. 修改数据传输模型 (schemas.py)
- 动作：找到对应的 Pydantic 模型（如 UserBase, UserCreate, UserResponse）。
- 操作：
    - 如果是前端传给后端的数据（如注册填写的昵称），加在 UserCreate。
    - 如果是后端返回给前端的数据（如最后登录时间），加在 UserResponse。
    - 如果不确定，通常加在 UserBase 会同时生效，但要注意隐私字段不要泄露。

## 阶段二：修改业务逻辑 (Logic)
这是告诉后端程序：“什么时候去读写这个新字段”。
### 3. 更新业务代码 (crud 或 endpoints)
- 动作：找到创建或更新该数据的接口（如 /register, /login）。
- 操作：
    - 写入时：确保实例化模型时传入了新字段，或者手动赋值。
    - 读取时：如果 Schema 配置正确，FastAPI 会自动处理，通常不用改代码。

## 阶段三：同步数据库结构 (Migration)
这是告诉 MySQL：“请把硬盘上的表结构也改一下”。（最容易忘记的一步）
### 4. 执行数据库变更
- 方法 A：暴力重置 (开发初期推荐)
    - 操作：在数据库客户端直接删除该表 (DROP TABLE users)，重启后端自动重建。
    - 优点：快，无残留。
    - 缺点：数据会清空。
- 方法 B：手动 SQL (保留数据推荐)
    - 操作：打开 Navicat/DBeaver，执行 SQL。

## 阶段四：验证 (Verification)
### 5. 联调测试
- 重启后端：确保新代码生效。
- 查看 Swagger 文档：刷新 http://127.0.0.1:8000/docs， 看 Schema 里的 Response Model 是否多了新字段。
- 功能测试：
    - 尝试插入一条数据（注册），看数据库该字段是否有值。
    - 尝试查询数据（获取信息），看接口返回值是否包含该字段。

----
#### 核心记忆口诀
改模型 (Model) -> 改接口 (Schema) -> 改逻辑 (Logic) -> 改数据库 (SQL)